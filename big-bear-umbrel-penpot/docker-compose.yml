
version: "3.7"
services:
  penpot-frontend:
    image: penpotapp/frontend:2.10.1
    restart: unless-stopped
    volumes:
      - ${APP_DATA_DIR}/assets:/opt/data/assets
    depends_on:
      - penpot-backend
      - penpot-exporter
    networks:
      - big-bear-penpot-network
  penpot-backend:
    image: penpotapp/backend:2.10.1
    restart: unless-stopped
    volumes:
      - ${APP_DATA_DIR}/assets:/opt/data/assets
    depends_on:
      - penpot-postgres
      - penpot-redis
    networks:
      - big-bear-penpot-network
    environment:
      - PENPOT_FLAGS=enable-registration enable-login-with-password disable-email-verification disable-secure-session-cookies
      - PENPOT_SECRET_KEY=big-bear-penpot-secret-key
      - PENPOT_PUBLIC_URI=http://big-bear-penpot-frontend:8080
      - PENPOT_DATABASE_URI=postgresql://big-bear-penpot-postgres/penpot
      - PENPOT_DATABASE_USERNAME=bigbear
      - PENPOT_DATABASE_PASSWORD=casaos
      - PENPOT_REDIS_URI=redis://big-bear-penpot-redis/0
      - PENPOT_ASSETS_STORAGE_BACKEND=assets-fs
      - PENPOT_STORAGE_ASSETS_FS_DIRECTORY=/opt/data/assets
      - PENPOT_TELEMETRY_ENABLED=false
  penpot-exporter:
    image: penpotapp/exporter:2.10.1
    restart: unless-stopped
    networks:
      - big-bear-penpot-network
    environment:
      - PENPOT_PUBLIC_URI=http://big-bear-penpot-frontend:8080
      - PENPOT_REDIS_URI=redis://big-bear-penpot-redis/0
  penpot-postgres:
    image: postgres:14
    restart: unless-stopped
    stop_signal: SIGINT
    volumes:
      - ${APP_DATA_DIR}/pgdata:/var/lib/postgresql/data
    networks:
      - big-bear-penpot-network
    environment:
      - POSTGRES_INITDB_ARGS=--data-checksums
      - POSTGRES_DB=penpot # Set the name of the database
      - POSTGRES_USER=bigbear # Set the username for the database
      - POSTGRES_PASSWORD=casaos # Set the password for the database
  penpot-redis:
    image: redis:7.4.6@sha256:d7432711a2a5c99c2e9dd0e006061cd274d7cb7a9e77f07ffe2ea99e21244677
    restart: unless-stopped
    networks:
      - big-bear-penpot-network
  penpot-mailcatch:
    image: sj26/mailcatcher:latest
    restart: always
    expose:
      - "1025" # Expose port 1025 for SMTP
    networks:
      - big-bear-penpot-network # Connect to the big-bear-penpot-network
  app_proxy:
    environment:
      APP_HOST: big-bear-umbrel-penpot_penpot-frontend_1
      APP_PORT: "8080"
networks:
  big-bear-penpot-network:
    driver: bridge

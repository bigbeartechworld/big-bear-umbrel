
version: "3.7"
services:
  big-bear-libredesk:
    image: libredesk/libredesk:v0.7.4-alpha
    restart: unless-stopped
    environment:
      - LIBREDESK_SYSTEM_USER_PASSWORD="c6b51a4e-ab9d-4f4f-933e-e96ed3570c1A"
    volumes:
      - ${APP_DATA_DIR}/uploads:/libredesk/uploads:rw
      - ${APP_DATA_DIR}/config:/libredesk/config:rw
    command: [sh, -c, "./libredesk --install --idempotent-install --yes --config /libredesk/config/config.toml && ./libredesk --upgrade --yes --config /libredesk/config/config.toml && ./libredesk --config /libredesk/config/config.toml"]
    depends_on:
      - big-bear-libredesk-db
      - big-bear-libredesk-redis
    networks:
      - big-bear-libredesk-network
  big-bear-libredesk-db:
    image: postgres:17-alpine
    restart: unless-stopped
    networks:
      - big-bear-libredesk-network
    environment:
      POSTGRES_USER: libredesk
      POSTGRES_PASSWORD: libredesk
      POSTGRES_DB: big_bear_libredesk
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U libredesk"]
      interval: 10s
      timeout: 5s
      retries: 6
    volumes:
      - ${APP_DATA_DIR}/data/postgres:/var/lib/postgresql/data
  big-bear-libredesk-redis:
    image: redis:7.4.6-alpine@sha256:7a7c6b5c49a6896d0a58ee0c6dc0dcabe14f30f0a2f7d2d1362d276fa2d43166
    restart: unless-stopped
    networks:
      - big-bear-libredesk-network
    volumes:
      - ${APP_DATA_DIR}/data/redis:/data
  app_proxy:
    environment:
      APP_HOST: big-bear-umbrel-libredesk_big-bear-libredesk_1
      APP_PORT: "9000"
networks:
  big-bear-libredesk-network:
    driver: bridge
